(()=>{"use strict";var __webpack_modules__={806(e,t,o){function n(e,t){let o=function(e,t){if(0===e.length)return;let o=e.shift();return t.push(o),o}(e,t);if(void 0===o)return;if("number"==typeof o)return o;switch(o){case"false":return!1;case"true":return!0;case"null":return null;case"undefined":return["@","undefined"]}let r=o[0];switch("#"==r&&(r=o.slice(0,2)),r){case"(":case"[":let i=function(e,t,o){let r,i=[];for(;void 0!==(r=n(e,t));){if("]"===r){"["!==o&&e.unshift("]");break}if(")"===r)break;i.push(r)}return i}(e,t,r);return i;case")":case"]":case"}":return r;case"{":return function(e,t){let o,r,i=[["#","dict"]];for(;void 0!==(o=n(e,t));)if("]"!==o){if("}"===o)break;r=n(e,t),i.push(o),i.push(r)}return i}(e,t);case'"':return o=o.replaceAll("\r\n","\n"),o=o.replaceAll("\n","\\n"),o=JSON.parse(o),o;case"@":return o=o.replace(/(^@|@$)/g,""),o=o.replace(/(@@)/g,"@"),o=o.trim(),["@",o];case"#|":return o=o.replace(/^#[\|]/g,""),o=o.replace(/[\|]#$/g,""),o=o.trim(),["@",o];case"#@":return o=o.replaceAll("\r\n","\n"),o=o.replace(/(^#@|@$)/g,""),o=o.replace(/(@@)/g,"@"),["#@",o];default:return":"===o[0]||"&"===o[0]?o:["#",..."."===o[0]?[o]:o.split(".")]}}function r(e){if(0===e.length)return"";let t=e.shift(),o=""+t;for(;e.length>0;){let n=e.shift();")"!==n&&"]"!==n&&"("!==t&"["!==t&&"'"!==t&&(o+=" "),"["===n&&(n="("),"]"===n&&(n=")"),o+=n,t=n}return o}function i(e){let t=function(e){let t,o=/[\s,]*([()\[\]{}'`]|"(?:\\.|[^\\"])*"|@(?:@@|[^@])*@|#@(?:@@|[^@])*@|;.*|#[!# ].*|#lang[ ]+.*|#[\|][\s\S]+?[\|]#|#[a-z]+|[^\s,()\[\]{}'"`;@]*)/g,n=[];for(;""!==(t=o.exec(e)[1]);)";"!==t[0]&&(t.startsWith("#!")||t.startsWith("##")||t.startsWith("# ")||t.startsWith("#lang ")||(t.startsWith("#@")||t.startsWith("#|")||!t.startsWith("#")||(t=t.substring(1)),isFinite(t)&&(t=parseFloat(t,10)),n.push(t)));return n}(e),o=[];for(;;){let e=[],i=n(t,e);if(void 0===i)break;")"!==i&&"]"!==i&&o.push([r(e),i])}return o}function l(e){if(null===e)return"null";if(void 0===e)return"undefined";if("number"==typeof e)return JSON.stringify(e);if("string"==typeof e)return JSON.stringify(e);if("boolean"==typeof e)return JSON.stringify(e);if(e instanceof Array){let t="( ";for(let o=0;o<e.length;o++)o>0&&(t+=" "),t+=l(e[o]);let o=Object.keys(e),n=/^[0-9]+/;if(o=o.filter(e=>!n.test(e)),o.sort(),o.length>0){e.length>0&&(t+=" "),t+="?";for(let n=0;n<o.length;n++){let r=o[n];t+=" (",t+=JSON.stringify(r),t+=" ",t+=l(e[r]),t+=")"}}return t+=" )",t}{let t="{ ",o=Object.keys(e);o.sort();for(let n=0;n<o.length;n++)n>0&&(t+=" "),t+=JSON.stringify(o[n]),t+=" ",t+=l(e[o[n]]);return t+=" }",t}}function c(e,t){if(e===t)return!0;if(e instanceof Function||t instanceof Function)return!1;if("object"==typeof e&&"object"==typeof t){const o=Object.keys(e),n=Object.keys(t);if(o.length!==n.length)return!1;for(let n=0;n<o.length;++n){const r=o[n];if(!1===c(e[r],t[r]))return!1}return!0}return!1}o.d(t,{Ph:()=>c,hu:()=>i,jn:()=>l})},275(e,t,o){o.d(t,{E:()=>n});class n{is_array(e){return e instanceof Array}is_bool(e){return"boolean"==typeof e}is_number(e){return"number"==typeof e}is_string(e){return"string"==typeof e}is_quoted(e){return!!this.is_array(e)&&0!==e.length&&"`"===e[0]}is_id(e,t=void 0){return!(!(e instanceof Array&&"#"===e[0])||t&&e[1]!==t)}is_variable(e){return 0!==e.length&&"#"===e[0]}is_script(e){return 0!==e.length&&"@"===e[0]}is_template(e){return 0!==e.length&&"#@"===e[0]}is_callable(e){return 0!==e.length&&"#"!==e[0]&&"@"!==e[0]&&(this.is_id(e[0])||this.is_script(e[0]))}is_fn(e){return 0!==e.length&&this.is_id(e[0])&&"fn"===this.to_id(e[0])}to_id(e){return this.is_id(e)?e.slice(1).join("."):this.is_script(e)?"<script>":e}id(e){return["#",e]}to_def(e){if(!this.is_array(e))return null;if(0===e.length)return null;switch(this.to_id(e[0])){case"def":{if(e.length<2)throw new Error("sysntax error");let t=e[1],o=2===e.length?null:e[2];return[this.id("def"),t,o]}case"defvar":{if(e.length<2)throw new Error("sysntax error");let t=e[1],o=2===e.length?null:e[2];return[this.id("def"),t,o]}case"defun":{let t=e.slice(3);return t.unshift(e[2]),t.unshift(this.id("fn")),[this.id("def"),e[1],t]}case"define":if(this.to_id(e[1])instanceof Array){if(e.length<2)throw new Error("sysntax error");let t=e.slice(2);return this.to_def([this.id("defun"),e[1][0],e[1].slice(1),...t])}{if(e.length<2)throw new Error("sysntax error");let t=e[1],o=2===e.length?null:e[2];return this.to_def([this.id("defvar"),t,o])}default:return null}}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={},_oml2ast_mjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(806),_omlcommon_mjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(275);let common=new _omlcommon_mjs__WEBPACK_IMPORTED_MODULE_1__.E;function compile_number(e){return`number_value(${compile_ast(e)})`}function compile_string(e){return`String(${compile_ast(e)})`}function compile_body_helper(e){if(0===e.length)return null;let t="(";for(let o=0;o<e.length;o++){o>0&&(t+=",");let n=common.to_def(e[o]);if(null!==n)return t+compile_ast([common.id("let"),[[n[1],n[2]]],...e.slice(o+1)])+")";t+=compile_ast(e[o])}return t+")"}function compile_body(e,t){let o=[];for(let n=t;n<e.length;n++)o.push(e[n]);return compile_body_helper(o)}function compile_ast(e){if(null===e)return"null";if(void 0===e)return"undefined";if("string"==typeof e)return JSON.stringify(e);if(!(e instanceof Array))return e.toString();if(0===e.length)return"[]";if(common.is_variable(e))return common.to_id(e);if(common.is_script(e))return e[1];if(common.is_template(e)){let t=e[1];return t=t.replace(/(`)/g,"\\`"),t=t.replace(/({{)/g,"${"),t=t.replace(/(}})/g,"}"),t="`"+t+"`",t}if(common.is_id(e[0])&&"?"===common.to_id(e[0]))return compile_ast([common.id("list"),...e]);if(!common.is_callable(e))return compile_ast([common.id("list"),...e]);switch(common.to_id(e[0])){case"<script>":{let r=e[0][1]+"(";for(let i=1;i<e.length;i++)i>1&&(r+=","),r+=compile_ast(e[i]);return r+=")",r}case"begin":return compile_body(e,1);case"case":{let l=[common.id("cond")];for(let c=2;c<e.length;c++){let s=e[c];common.is_id(s[0],"else")||common.is_id(s[0],"otherwise")?l.push(s):l.push([[common.id("equal"),common.id("__case__"),s[0]],...s.slice(1)])}return compile_ast([common.id("let*"),[[common.id("__case__"),e[1]]],l])}case"_cond":{function _(e){if(0===e.length)return null;let t=e.shift();t=common.to_id(t);let o=e.shift();switch(t){case!0:case"else":case"otherwise":return o}return[common.id("if"),t,o,_(e)]}return compile_ast(e=_(e.slice(1)))}case"cond":{let m=[];return e.slice(1).forEach(e=>{m.push(e[0]),m.push([["#","begin"]].concat(e.slice(1)))}),m.unshift(["#","_cond"]),compile_ast(m)}case"dec!":case"inc!":let o="dec!"===common.to_id(e[0])?"-":"+",n=e.length<3?1:compile_ast(e[2]);return compile_ast(e[1])+o+"="+n;case"def":return e=common.to_def(e),"globalThis."+common.to_id(e[1])+"="+compile_ast(e[2]);case"define":case"defun":case"defvar":return compile_ast(e=common.to_def(e));case"do":case"do*":return compile_do(e);case"fn":case"lambda":{let u="(";for(let a=0;a<e[1].length;a++)a>0&&(u+=","),u+=common.to_id(e[1][a]);return u+=")",e.length<3?"function"+u+"{}":"function"+u+"{return "+compile_body(e,2)+"}"}case"dotimes":{let d=e[1];if(!common.is_array(d)||common.is_quoted(d))d=[common.id("$index"),d];else if(d.length<2)throw new Error("syntax error");let f=d.length<3?common.id("null"):d[2],p=[[common.id("__dotimes_cnt__"),d[1]],[common.id("__dotimes_idx__"),0,[common.id("+"),common.id("__dotimes_idx__"),1]],[d[0],common.id("__dotimes_idx__"),common.id("__dotimes_idx__")]],h=[[common.id(">="),common.id("__dotimes_idx__"),common.id("__dotimes_cnt__")],f];return compile_ast(e=[common.id("do*"),p,h].concat(e.slice(2)))}case"length":return 2!=e.length?new Error("syntax error"):"("+compile_ast(e[1])+").length";case"prop-get":return 3!=e.length?new Error("syntax error"):compile_ast(e[1])+"["+compile_ast(e[2])+"]";case"prop-set!":return 4!=e.length?new Error("syntax error"):compile_ast(e[1])+"["+compile_ast(e[2])+"]="+compile_ast(e[3]);case"dolist":{let g=e[1];if(common.is_variable(g)||!common.is_array(g)||common.is_quoted(g))g=[common.id("$item"),g];else if(g.length<2)throw new Error("syntax error");let b=g.length<3?common.id("null"):g[2],y=[[common.id("__dolist_list__"),g[1]],[common.id("__dolist_cnt__"),[common.id("length"),common.id("__dolist_list__")]],[common.id("__dolist_idx__"),0,[common.id("+"),common.id("__dolist_idx__"),1]],[g[0],[common.id("prop-get"),common.id("__dolist_list__"),common.id("__dolist_idx__")],[common.id("prop-get"),common.id("__dolist_list__"),common.id("__dolist_idx__")]]],w=[[common.id(">="),common.id("__dolist_idx__"),common.id("__dolist_cnt__")],b];return compile_ast(e=[common.id("do*"),y,w].concat(e.slice(2)))}case"if":return"("+compile_ast(e[1])+"?"+compile_ast(e[2])+":"+compile_body(e,3)+")";case"let":case"let*":{let x=e[1],E=[];for(let O of x)"string"==typeof O?(E.push(O),E.push(void 0)):(E.push(O[0]),E.push(O[1]));return compile_ast([common.id("_"+common.to_id(e[0])),E].concat(e.slice(2)))}case"_let":case"_let*":{let v="(",j="(",A="";for(let k=1;k<e[1].length;k+=2){k>1&&(v+=","),v+=common.to_id(e[1][k-1]);let S=compile_ast(e[1][k]);k>1&&(j+=","),j+=S,A+=common.to_id(e[1][k-1])+"="+S+";"}return v+=")",j+=")","_let"===common.to_id(e[0])?"((function"+v+"{return "+compile_body(e,2)+"})"+j+")":"((function"+v+"{"+A+"return "+compile_body(e,2)+"})())"}case"list":{e=e.slice(1);let P,T,D=-1;for(let M=0;M<e.length;M++){let N=e[M];if(common.is_id(N)&&"?"===common.to_id(N)){D=M;break}}-1===D?(P=e,T=[]):0===D?(P=[],T=e.slice(1)):(P=e.slice(0,D),T=e.slice(D+1));let q=[];for(let W=0;W<P.length;W++)q.push([common.id("prop-set!"),common.id("__obj__"),W,P[W]]);for(let J=0;J<T.length;J++){let C=T[J];common.is_string(C)&&(C=[C,!0]),q.push([common.id("prop-set!"),common.id("__obj__"),C[0],C[1]])}return q.push(common.id("__obj__")),compile_ast(e=[common.id("let*"),[[common.id("__obj__"),["@","[]"]]],...q])}case"dict":{if(e.length%2!=1)throw new Error("synatx error");let I=[];for(let L=1;L<e.length;L+=2)I.push([common.id("prop-set!"),common.id("__dict__"),e[L],e[L+1]]);return I.push(common.id("__dict__")),compile_ast(e=[common.id("let*"),[[common.id("__dict__"),["@","{}"]]],...I])}case"set!":case"setq":return compile_ast(e[1])+"="+compile_ast(e[2]);case"throw":return"(function(){throw "+compile_ast(e[1])+"})()";case"try":{let $="(function(){try{return "+compile_ast(e[1])+"}catch(";if("catch"!=common.to_id(e[2][0]))throw"try without catch clause";return $+=common.to_id(e[2][1])+"){return "+compile_body(e[2],2)+"}",$+="})()",$}case"until":case"while":{let B=compile_ast(e[1]);return"until"===common.to_id(e[0])&&(B="!"+B),"((function(){while("+B+"){"+compile_body(e,2)+"}})(),null)"}case".":{let K="+",R=e.slice(1),U=[];for(let F=0;F<R.length;F++)F>0&&U.push(K),U.push(compile_string(R[F]));return U.join("")}case"=":return"("+compile_ast(e[1])+"==="+compile_ast(e[2])+")";case"%":case"==":case"===":case"!=":case"!==":case"<":case">":case"<=":case">=":return"("+compile_number(e[1])+common.to_id(e[0])+compile_number(e[2])+")";case"&&":case"||":case"&":case"|":case"+":case"-":case"*":case"**":case"/":return"("+insert_op(common.to_id(e[0]),e.slice(1))+")";default:{let z=common.to_id(e[0])+"(";for(let X=1;X<e.length;X++)X>1&&(z+=","),z+=compile_ast(e[X]);return z+=")",z}}}function insert_op(e,t){if(1===t.length)return e+compile_number(t[0]);let o=[];for(let n=0;n<t.length;n++)n>0&&o.push(e),o.push(compile_number(t[n]));return o.join("")}function compile_do(e){let t=e[1],o="do"===e[0],n=t.length,r=[];o&&(r.push("__do__"),r.push("new Array("+n+").fill(null)")),t.forEach(e=>{r.push(e[0]),r.push(e[1])});let i=e[2];i.length<2&&(i=[i[0],null]);let l=[common.id("until"),i[0]].concat(e.slice(3));o?(t.forEach((e,t)=>{if(e.length<3)return;let o=[id("set!"),"__do__["+t+"]",e[2]];l.push(o)}),t.forEach((e,t)=>{if(e.length<3)return;let o=[id("set!"),e[0],"__do__["+t+"]"];l.push(o)})):t.forEach(e=>{if(e.length<3)return;let t=[common.id("set!"),e[0],e[2]];l.push(t)});let c=[o?common.id("_let"):common.id("_let*"),r].concat([l]);return c.push(i[1]),compile_ast(c)}function omljs(){let glob={compile_ast:(e,t)=>{t&&console.log(" [AST] "+JSON.stringify(e));let o=compile_ast(e);return t&&console.log("[CODE] "+o),o},compile:(e,t)=>{let o=(0,_oml2ast_mjs__WEBPACK_IMPORTED_MODULE_0__.hu)(e),n="";for(let e of o){let o=e[0],r=e[1];t&&console.log("[LISP] "+o),t&&console.log(" [AST] "+JSON.stringify(r));let i=compile_ast(r);t&&console.log("[CODE] "+i),n+=i+";\n"}return n},exec_d:e=>glob.exec(e,!0),exec:(exp,debug)=>{let src=exp,steps=(0,_oml2ast_mjs__WEBPACK_IMPORTED_MODULE_0__.hu)(src),last,text="";for(let step of steps){let exp=step[0],ast=step[1];var tm1=(new Date).getTime();try{debug&&console.log("[LISP] "+exp),debug&&console.log(" [AST] "+JSON.stringify(ast)),text=compile_ast(ast),debug&&console.log("[CODE] "+text);let val=eval(text),output;if(last=val,"function"==typeof val)output="function";else if(!(val instanceof Array)&&val instanceof Object&&"[object Object]"!==Object.prototype.toString.call(val))try{output=Object.prototype.toString.call(val)+" "+JSON.stringify(val)}catch(e){}else try{output=JSON.stringify(val)}catch(e){}var tm2=(new Date).getTime();debug&&(void 0===output?(console.log("==> ("+(tm2-tm1)+" ms)"),console.log(val)):console.log("==> "+output+" ("+(tm2-tm1)+" ms)"))}catch(e){throw debug||console.log("[LISP] "+exp),debug||console.log(" [AST] "+JSON.stringify(ast)),debug||console.log("[CODE] "+text),console.log("[EXCEPTION]"),e.stack?console.log(e.stack):console.log(e),e}}return last},run:e=>glob.exec(e,!0),execAll:(exp,debug)=>{let text=glob.compile(exp,debug);try{return eval(text)}catch(e){throw e.stack?console.log(e.stack):console.log(e),e}},runAll:e=>glob.execAll(e,!0)};return glob}function run(e){return omljs().run(e)}function runAll(e){return omljs().runAll(e)}function print(e){return console.log((0,_oml2ast_mjs__WEBPACK_IMPORTED_MODULE_0__.jn)(e)),e}function number_value(e){return"number"!=typeof e?0:e}function equal(e,t){return(0,_oml2ast_mjs__WEBPACK_IMPORTED_MODULE_0__.Ph)(e,t)}globalThis.omljs=omljs,globalThis.run=run,globalThis.runAll=runAll,globalThis.print=print,globalThis.number_value=number_value,globalThis.equal=equal})();